<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>忘記密碼 | Momento</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="../../css/momento-theme.css" rel="stylesheet">
    <style>
        .auth-container {
            min-height: calc(100vh - 60px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
        }

        .auth-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 420px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-color);
            margin: 0 8px;
            transition: all 0.3s;
        }

        .step-dot.active {
            background: var(--momento-green);
            transform: scale(1.2);
        }

        .step-dot.completed {
            background: var(--momento-green);
        }

        .reset-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .reset-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .otp-inputs {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .otp-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background: #242424;
            color: white;
            transition: all 0.2s;
        }

        .otp-input:focus {
            border-color: var(--momento-green);
            outline: none;
            box-shadow: 0 0 0 4px rgba(45, 95, 79, 0.2);
        }

        .password-strength {
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: all 0.3s;
        }

        .strength-weak {
            width: 33%;
            background: #EF4444;
        }

        .strength-medium {
            width: 66%;
            background: #F59E0B;
        }

        .strength-strong {
            width: 100%;
            background: #10B981;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(16, 185, 129, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            animation: successPop 0.5s ease;
        }

        @keyframes successPop {
            0% {
                transform: scale(0);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="bg-black text-white">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top border-bottom border-secondary">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <span class="text-success">Momento</span>
            <div class="ms-auto d-flex align-items-center gap-2">
            <a href="login" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-arrow-left me-2"></i>返回登入
            </a>
            </div>
        </div>
    </nav>


    <div class="auth-container">
        <div class="auth-card">
            <!-- Step Indicator -->
            <!--             <div class="step-indicator"> -->
            <!--                 <div class="step-dot active" data-step="1"></div> -->
            <!--                 <div class="step-dot" data-step="2"></div> -->
            <!--                 <div class="step-dot" data-step="3"></div> -->
            <!--                 <div class="step-dot" data-step="4"></div> -->
            <!--             </div> -->

            <!-- Step 1: Enter Email -->
            <div class="reset-step active" id="step1">
                <div class="text-center mb-4">
                    <!--                     <div class="mb-3"> -->
                    <!--                         <i class="fas fa-lock fa-3x text-muted"></i> -->
                    <!--                     </div> -->
                    <!--                     <h4 class="mb-2">忘記密碼？</h4> -->
                    <!--                     <p class="text-muted small">請輸入您的註冊信箱，我們會發送驗證碼給您</p> -->
                    <!--                 </div> -->

                    <!--                 <form id="emailForm"> -->
                    <!--                     <div class="mb-4"> -->
                    <!--                         <label class="form-label">電子郵件</label> -->
                    <!--                         <div class="input-group"> -->
                    <!--                             <span class="input-group-text bg-dark border-secondary text-muted"> -->
                    <!--                                 <i class="fas fa-envelope"></i> -->
                    <!--                             </span> -->
                    <!--                             <input type="text" class="form-control bg-dark text-white border-secondary"  -->
                    <!--                                 id="resetEmail" placeholder="name@example.com"> -->
                    <!--                         </div> -->
                    <!--                     </div> -->
                    <!--                     <button type="submit" class="btn btn-primary w-100"> -->
                    <!--                         <i class="fas fa-paper-plane me-2"></i>發送驗證碼 -->
                    <!--                     </button> -->
                    <!--                 </form> -->

                    <!--                 <div class="text-center mt-4"> -->
                    <!--                     <small class="text-muted"> -->
                    <!--                         想起密碼了？<a href="login.html" class="text-success">返回登入</a> -->
                    <!--                     </small> -->
                    <!--                 </div> -->
                </div>

                <!--             Step 2: Enter OTP -->
                <!--             <div class="reset-step" id="step2"> -->
                <!--                 <div class="text-center mb-4"> -->
                <!--                     <div class="mb-3"> -->
                <!--                         <i class="fas fa-mobile-alt fa-3x text-success"></i> -->
                <!--                     </div> -->
                <!--                     <h4 class="mb-2">輸入驗證碼</h4> -->
                <!--                     <p class="text-muted small"> -->
                <!--                         驗證碼已發送至 <span id="maskedEmail" class="text-white">t***@example.com</span> -->
                <!--                     </p> -->
                <!--                 </div> -->

                <!--                 <form id="otpForm"> -->
                <!--                     <div class="otp-inputs mb-4"> -->
                <!--                         <input type="text" class="otp-input" maxlength="1" data-index="0"> -->
                <!--                         <input type="text" class="otp-input" maxlength="1" data-index="1"> -->
                <!--                         <input type="text" class="otp-input" maxlength="1" data-index="2"> -->
                <!--                         <input type="text" class="otp-input" maxlength="1" data-index="3"> -->
                <!--                         <input type="text" class="otp-input" maxlength="1" data-index="4"> -->
                <!--                         <input type="text" class="otp-input" maxlength="1" data-index="5"> -->
                <!--                     </div> -->

                <!--                     <button type="submit" class="btn btn-primary w-100 mb-3"> -->
                <!--                         驗證 -->
                <!--                     </button> -->
                <!--                 </form> -->

                <!--                 <div class="text-center"> -->
                <!--                     <p class="text-muted small mb-2"> -->
                <!--                         沒收到驗證碼？<span id="resendTimer" class="text-success">60 秒後可重發</span> -->
                <!--                     </p> -->
                <!--                     <button class="btn btn-link text-muted small p-0" id="btnResend" disabled> -->
                <!--                         重新發送驗證碼 -->
                <!--                     </button> -->
                <!--                 </div> -->
                <!--             </div> -->

                <!--             Step 3: New Password -->
                <div class="reset-step active" id="step3">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <i class="fas fa-key fa-3x text-warning"></i>
                        </div>
                        <h4 class="mb-2">設定新密碼</h4>
                        <p class="text-muted small">請輸入您的新密碼</p>
                    </div>

                    <form th:action="@{/organizer/reset-password}" id="passwordForm" method="post">
                        <div class="mb-3">
                            <input type="hidden" name="token" th:value="${token}">
                            <label class="form-label">新密碼</label>
                            <div class="input-group">
                                <input type="password" name="newPassword"
                                    class="form-control bg-dark text-white border-secondary" id="newPassword"
                                    placeholder="至少 8 個字元">
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword1">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <!--                         <div class="password-strength"> -->
                            <!--                             <div class="password-strength-bar" id="strengthBar"></div> -->
                            <!--                         </div> -->
                            <!--                         <small class="text-muted mt-1 d-block" id="strengthText">密碼強度</small> -->
                        </div>

                        <div class="mb-4">
                            <label class="form-label">確認新密碼</label>
                            <div class="input-group">
                                <input type="password" class="form-control bg-dark text-white border-secondary"
                                    id="confirmPassword" placeholder="再次輸入新密碼" required>
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword2">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small class="text-danger d-none" id="passwordMismatch">
                                <i class="fas fa-exclamation-circle me-1"></i>密碼不一致
                            </small>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-check me-2"></i>重設密碼
                        </button>
                    </form>
                </div>

                <!-- Step 4: Success -->
                <div class="reset-step" id="step4">
                    <div class="text-center">
                        <div class="success-icon">
                            <i class="fas fa-check fa-2x text-success"></i>
                        </div>
                        <h4 class="mb-2">密碼重設成功！</h4>
                        <p class="text-muted mb-4">您的密碼已經更新，現在可以使用新密碼登入</p>

                        <a href="login.html" class="btn btn-primary w-100 mb-3">
                            <i class="fas fa-sign-in-alt me-2"></i>前往登入
                        </a>
                        <a href="../../index.html" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-home me-2"></i>回到首頁
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="../../js/common.js"></script>
        <script>
            window.onload = function () {
                const params = new URLSearchParams(window.location.search);
                if (params.toString() !== "") {
                    if (params.has('tokenError')) {
                        alert("連結失效或已過時");
                    } else if (params.has('error')) {
                        alert("修改失敗，請再試一次！");
                    }
                    const cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                    window.history.replaceState({ path: cleanUrl }, '', cleanUrl);
                }
            }

            $(document).ready(function () {
                // 1. 密碼可見切換
                $('#togglePassword1').click(function () {
                    const input = $('#newPassword');
                    const icon = $(this).find('i');
                    if (input.attr('type') === 'password') {
                        input.attr('type', 'text');
                        icon.removeClass('fa-eye').addClass('fa-eye-slash');
                    } else {
                        input.attr('type', 'password');
                        icon.removeClass('fa-eye-slash').addClass('fa-eye');
                    }
                });

                $('#togglePassword2').click(function () {
                    const input = $('#confirmPassword');
                    const icon = $(this).find('i');
                    if (input.attr('type') === 'password') {
                        input.attr('type', 'text');
                        icon.removeClass('fa-eye').addClass('fa-eye-slash');
                    } else {
                        input.attr('type', 'password');
                        icon.removeClass('fa-eye-slash').addClass('fa-eye');
                    }
                });

                // 2. 表單驗證
                $('#passwordForm').on('submit', function (e) {
                    const newPwd = $('#newPassword').val();
                    const confirmPwd = $('#confirmPassword').val();
                    const errorMsg = $('#passwordMismatch');

                    // 重置錯誤訊息
                    errorMsg.addClass('d-none');

                    // 檢查長度
                    if (!newPwd || newPwd.length < 8) {
                        e.preventDefault();
                        errorMsg.html('<i class="fas fa-exclamation-circle me-1"></i>密碼長度至少需 8 個字元');
                        errorMsg.removeClass('d-none');
                        return;
                    }

                    // 檢查一致性
                    if (newPwd !== confirmPwd) {
                        e.preventDefault();
                        errorMsg.html('<i class="fas fa-exclamation-circle me-1"></i>兩次輸入的密碼不一致');
                        errorMsg.removeClass('d-none');
                    }
                });
            });

            // Toast helper function
            function showToast(message, type) {
                let container = document.getElementById('toastContainer');
                if (!container) {
                    container = document.createElement('div');
                    container.id = 'toastContainer';
                    container.className = 'toast-container position-fixed top-0 end-0 p-3';
                    container.style.zIndex = '9999';
                    document.body.appendChild(container);
                }
                const bgClass = type === 'success' ? 'bg-success' : type === 'warning' ? 'bg-warning' : 'bg-danger';
                const iconClass = type === 'success' ? 'fa-check-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-times-circle';
                const toast = document.createElement('div');
                toast.className = `toast show align-items-center text-white ${bgClass} border-0`;
                toast.innerHTML = `<div class="d-flex"><div class="toast-body"><i class="fas ${iconClass} me-2"></i>${message}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" onclick="this.closest('.toast').remove()"></button></div>`;
                container.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        </script>
</body>

</html>