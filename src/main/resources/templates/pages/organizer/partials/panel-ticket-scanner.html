<div class="d-flex justify-content-between align-items-center mb-4">
	<h2 class="h3">
		<i class="fas fa-qrcode me-2"></i>票券掃描核銷
	</h2>
	<div class="d-flex gap-2">
		<select class="form-select bg-dark text-white border-secondary"
			name="eventId" id="scannerEventSelect" style="width: 250px;">
			<option value="null">選擇活動</option>
			<option th:each="event: ${activeEvents}" th:value="${event.eventId}"
				th:text="${event.title}" selected>2025新年音樂會｜維也納之夜</option>
		</select>
	</div>
</div>

<div class="row g-4">
	<!-- 掃描區域 -->
	<div class="col-lg-6">
		<div class="card bg-dark border-secondary">
			<div class="card-header border-secondary">
				<h5 class="mb-0">
					<i class="fas fa-camera me-2"></i>掃描 QRCode
				</h5>
			</div>
			<div class="card-body text-center">
				<!-- 相機預覽區 -->
				<div id="qrScannerPreview"
					class="bg-black rounded mb-3 position-relative"
					style="height: 300px;">
					<video id="scannerVideo" class="w-100 h-100 rounded"
						style="object-fit: cover;"></video>
					<div
						class="position-absolute top-50 start-50 translate-middle text-white"
						id="scannerPlaceholder">
						<i class="fas fa-camera fa-3x mb-3 text-muted"></i>
						<p class="text-muted">點擊下方按鈕開啟相機</p>
					</div>
					<!-- 掃描框 -->
					<div
						class="position-absolute top-50 start-50 translate-middle d-none"
						id="scannerFrame"
						style="width: 200px; height: 200px; border: 3px solid var(--momento-green); border-radius: 12px;">
						<div class="position-absolute top-0 start-0 w-100"
							style="height: 3px; background: var(--momento-green); animation: scanLine 2s linear infinite;">
						</div>
					</div>
				</div>

				<div class="d-flex gap-2 justify-content-center mb-3">
					<button class="btn btn-primary" id="btnStartScanner">
						<i class="fas fa-play me-2"></i>開始掃描
					</button>
					<button class="btn btn-outline-secondary" id="btnStopScanner"
						disabled>
						<i class="fas fa-stop me-2"></i>停止掃描
					</button>
				</div>

				<!-- 手動輸入 -->
				<div class="border-top border-secondary pt-3 mt-3">
					<p class="text-muted small mb-2">或手動輸入票券代碼</p>
					<div class="input-group">
						<input type="text"
							class="form-control bg-dark text-white border-secondary"
							name="randomUUID"
							placeholder="輸入票券代碼 (例: QR-EVT001-001-20241115)"
							id="manualTicketCode">
						<button class="btn btn-outline-primary" id="btnManualVerify">
							<i class="fas fa-check me-1"></i>驗證
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 驗證結果 -->
	<div class="col-lg-6">
		<div class="card bg-dark border-secondary mb-4">
			<div class="card-header border-secondary">
				<h5 class="mb-0">
					<i class="fas fa-clipboard-check me-2"></i>驗證結果
				</h5>
			</div>
			<div class="card-body" id="verificationResult" th:fragment="success">
				<div class="text-center text-muted py-5" th:if="${msg == null}">
					<i class="fas fa-qrcode fa-4x mb-3"></i>
					<p>等待掃描票券...</p>
				</div>
				<div class="text-center" th:if="${msg == '核銷成功' }">
					<div
						class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
						style="width: 80px; height: 80px;">
						<i class="fas fa-check-circle fa-3x text-success"></i>
					</div>
					<h4 class="text-success mb-3">核銷成功</h4>
					<div class="text-start bg-dark rounded p-3 mb-3">
						<div class="row mb-2">
							<div class="col-4 text-muted">訂單編號</div>
							<div class="col-8">
								<code id="info-order-id"  th:text="${information.eventOrder.eventOrderId}">${ticketCode}</code>
							</div>
						</div>
						<div class="row mb-2">
							<div class="col-4 text-muted">票券編號</div>
							<div class="col-8">
								<code id="info-ticket-id"  th:text="${information.eventOrderItemId}">${ticketCode}</code>
							</div>
						</div>
						<div class="row mb-2">
							<div class="col-4 text-muted">票種</div>
							<div class="col-8">
								<code  id="info-ticket-name" th:text="${information.ticket.ticketName}">貴賓席</code>
							</div>
						</div>
						<div class="row mb-2">
							<div class="col-4 text-muted">購票人</div>
							<div class="col-8">
								<code  id="info-user-name" th:text="${information.eventOrder.member.name}">林書涵</code>
							</div>
						</div>
					</div>
					<!-- 					<button class="btn btn-primary w-100" onclick="resetVerification()"> -->
					<!-- 						<i class="fas fa-qrcode me-2"></i>繼續掃描 -->
					<!-- 					</button> -->
				</div>
				<div class="text-center" th:if="${msg!= null and msg!='核銷成功'}">
					<div
						class="bg-danger bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
						style="width: 80px; height: 80px;">
						<i class="fas fa-times-circle fa-3x text-danger"></i>
					</div>
					<h4 class="text-danger mb-3">驗證失敗</h4>
					<p class="text-muted mb-4" th:text="${msg}">${message}</p>
					<button class="btn btn-outline-danger w-100"
						onclick="resetVerification()">
						<i class="fas fa-redo me-2"></i>重新掃描
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- 今日核銷統計 -->
	<!--         <div class="card bg-dark border-secondary"> -->
	<!--             <div class="card-header border-secondary d-flex justify-content-between align-items-center"> -->
	<!--                 <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>今日核銷統計</h5> -->
	<!--                 <span class="badge bg-primary">2024/12/31</span> -->
	<!--             </div> -->
	<!--             <div class="card-body"> -->
	<!--                 <div class="row g-3 text-center"> -->
	<!--                     <div class="col-4"> -->
	<!--                         <div class="p-3 bg-success bg-opacity-10 rounded"> -->
	<!--                             <h3 class="text-success mb-1" id="statVerified">156</h3> -->
	<!--                             <small class="text-muted">已核銷</small> -->
	<!--                         </div> -->
	<!--                     </div> -->
	<!--                     <div class="col-4"> -->
	<!--                         <div class="p-3 bg-warning bg-opacity-10 rounded"> -->
	<!--                             <h3 class="text-warning mb-1" id="statPending">244</h3> -->
	<!--                             <small class="text-muted">待入場</small> -->
	<!--                         </div> -->
	<!--                     </div> -->
	<!--                     <div class="col-4"> -->
	<!--                         <div class="p-3 bg-info bg-opacity-10 rounded"> -->
	<!--                             <h3 class="text-info mb-1" id="statTotal">400</h3> -->
	<!--                             <small class="text-muted">總票數</small> -->
	<!--                         </div> -->
	<!--                     </div> -->
	<!--                 </div> -->
	<!--                 <div class="progress mt-3" style="height: 8px;"> -->
	<!--                     <div class="progress-bar bg-success" style="width: 39%"></div> -->
	<!--                 </div> -->
	<!--                 <small class="text-muted d-block mt-2">入場率：39%</small> -->
	<!--             </div> -->
	<!--         </div> -->
</div>
</div>

<!-- 最近核銷紀錄 -->
<div class="card bg-dark border-secondary mt-4">
	<div
		class="card-header border-secondary d-flex justify-content-between align-items-center">
		<h5 class="mb-0">
			<i class="fas fa-history me-2"></i>最近核銷紀錄
		</h5>
		<!--         <button class="btn btn-sm btn-outline-secondary"> -->
		<!--             <i class="fas fa-download me-1"></i>匯出紀錄 -->
		<!--         </button> -->
	</div>
	<div class="table-responsive">
		<table class="table table-dark table-hover mb-0">
			<thead>
				<tr>
					<th>訂單編號</th>
					<th>票券編號</th>
					<th>票種</th>
					<th>購票人</th>
					<th>狀態</th>
				</tr>
			</thead>
			<tbody id="recentVerifications">
				<tr th:each="info : ${checkedIn}" th:if="${checkedIn != null}">
					<td><code th:text="${info.eventOrder.eventOrderId}">QR-EVT001-156-20241231</code></td>
					<td><code th:text="${info.eventOrderItemId}">QR-EVT001-156-20241231</code></td>
					<td th:text="${info.ticket.ticketName}">貴賓席</td>
					<td th:text="${info.eventOrder.member.name}">林書涵</td>
					<td><span class="badge bg-success">已核銷</span></td>

				</tr>
<!-- 				<tr> -->
<!-- 					<td><code>QR-EVT001-155-20241231</code></td> -->
<!-- 					<td>一般席</td> -->
<!-- 					<td>陳柏翰</td> -->
<!-- 					<td><span class="badge bg-success">已核銷</span></td> -->
<!-- 				</tr> -->
				<!--                 <tr class="table-danger"> -->
				<!--                     <td>18:42:08</td> -->
				<!--                     <td><code>QR-EVT001-099-20241231</code></td> -->
				<!--                     <td>一般席</td> -->
				<!--                     <td>-</td> -->
				<!--                     <td><span class="badge bg-danger">無效票券</span></td> -->
				<!--                     <td>工作人員B</td> -->
				<!--                 </tr> -->
				<!--                 <tr> -->
				<!--                     <td>18:40:55</td> -->
				<!--                     <td><code>QR-EVT001-154-20241231</code></td> -->
				<!--                     <td>貴賓席</td> -->
				<!--                     <td>張雅晴</td> -->
				<!--                     <td><span class="badge bg-success">已入場</span></td> -->
				<!--                     <td>工作人員A</td> -->
				<!--                 </tr> -->
			</tbody>
		</table>
	</div>
</div>