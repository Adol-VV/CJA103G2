<h2 class="h3 mb-4">活動管理列表</h2>

<div class="card bg-dark border-secondary mb-4">
    <div class="card-header border-secondary">
        <ul class="nav nav-tabs card-header-tabs">
            <li class="nav-item">
                <a class="nav-link" th:classappend="${param.status == null} ? 'active text-white' : 'text-muted'"
                    href="/organizer/event/list">全部</a>
            </li>
            <li class="nav-item">
                <a class="nav-link"
                    th:classappend="${param.status != null and param.status[0] == '0' and param.reviewStatus != null and param.reviewStatus[0] == '0'} ? 'active text-white' : 'text-muted'"
                    href="/organizer/event/list?status=0&reviewStatus=0">待審核</a>
            </li>
            <li class="nav-item">
                <a class="nav-link"
                    th:classappend="${param.reviewStatus != null and param.reviewStatus[0] == '2'} ? 'active text-white' : 'text-muted'"
                    href="/organizer/event/list?status=0&reviewStatus=2">已駁回</a>
            </li>
            <li class="nav-item">
                <a class="nav-link"
                    th:classappend="${param.status != null and param.status[0] == '1'} ? 'active text-white' : 'text-muted'"
                    href="/organizer/event/list?status=1&reviewStatus=1">已上架</a>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <form method="get" action="/organizer/event/list" class="d-flex">
            <input type="hidden" name="status" th:value="${param.status}">
            <input type="hidden" name="reviewStatus" th:value="${param.reviewStatus}">
            <div class="input-group">
                <input type="text" name="keyword" class="form-control bg-dark text-white border-secondary"
                    placeholder="搜尋活動名稱..." th:value="${param.keyword}">
                <button type="submit" class="btn btn-outline-secondary">搜尋</button>
            </div>
        </form>
    </div>
</div>

<div class="card bg-dark border-secondary">
    <div class="table-responsive">
        <table class="table table-dark table-hover align-middle mb-0">
            <thead>
                <tr>
                    <th>活動名稱</th>
                    <th>日期</th>
                    <th>狀態</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="event : ${events}">
                    <td>
                        <div class="fw-bold" th:text="${event.title}">活動名稱</div>
                        <small class="text-muted" th:text="${event.place}">活動地點</small>
                    </td>
                    <td th:text="${#temporals.format(event.eventAt, 'yyyy/MM/dd')}">2024/12/31</td>
                    <td>
                        <!-- 草稿: S=0, R=0, P=null -->
                        <span th:if="${event.status == 0 && event.reviewStatus == 0 && event.publishedAt == null}"
                            class="badge bg-secondary">草稿</span>

                        <!-- 待審核: S=0, R=0, P!=null -->
                        <span th:if="${event.status == 0 && event.reviewStatus == 0 && event.publishedAt != null}"
                            class="badge bg-warning text-dark">待審核</span>

                        <!-- 駁回: S=0, R=2 -->
                        <span th:if="${event.status == 0 && event.reviewStatus == 2}" class="badge bg-danger">已駁回</span>

                        <!-- 已上架: S=1, R=1 -->
                        <span th:if="${event.status == 1 && event.reviewStatus == 1}"
                            class="badge bg-success">已上架</span>
                    </td>
                    <td class="text-end">
                        <div class="btn-group">
                            <!-- 草稿 (S=0, R=0, P=null): 編輯、送審、刪除 -->
                            <th:block
                                th:if="${event.status == 0 && event.reviewStatus == 0 && event.publishedAt == null}">
                                <a th:href="@{/organizer/event/edit/{id}(id=${event.eventId})}"
                                    class="btn btn-sm btn-outline-light">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button class="btn btn-sm btn-success"
                                    th:onclick="'submitEvent(' + ${event.eventId} + ')'">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger"
                                    th:onclick="'deleteEvent(' + ${event.eventId} + ')'">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </th:block>

                            <!-- 待審核 (S=0, R=0, P!=null): 撤回 -->
                            <th:block
                                th:if="${event.status == 0 && event.reviewStatus == 0 && event.publishedAt != null}">
                                <button class="btn btn-sm btn-warning"
                                    th:onclick="'withdrawEvent(' + ${event.eventId} + ')'">
                                    <i class="fas fa-undo"></i> 撤回
                                </button>
                            </th:block>

                            <!-- 駁回 (S=0, R=2): 編輯、重新送審、刪除 -->
                            <th:block th:if="${event.status == 0 && event.reviewStatus == 2}">
                                <a th:href="@{/organizer/event/edit/{id}(id=${event.eventId})}"
                                    class="btn btn-sm btn-outline-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button class="btn btn-sm btn-success"
                                    th:onclick="'submitEvent(' + ${event.eventId} + ')'">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger"
                                    th:onclick="'deleteEvent(' + ${event.eventId} + ')'">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </th:block>

                            <!-- 已上架 (S=1, R=1): 查看 -->
                            <th:block th:if="${event.status == 1 && event.reviewStatus == 1}">
                                <a th:href="@{/event/{id}(id=${event.eventId})}" target="_blank"
                                    class="btn btn-sm btn-outline-info">
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                            </th:block>
                        </div>
                    </td>
                </tr>

                <tr th:if="${events == null or events.isEmpty()}">
                    <td colspan="4" class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                        尚無活動資料
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>