<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="h3"><i class="fas fa-bell me-2"></i>通知中心</h2>
    <div>
        <button class="btn btn-outline-secondary btn-sm me-2" id="btnMarkAllRead">
            <i class="fas fa-check-double me-1"></i>全部標為已讀
        </button>
        <button class="btn btn-outline-danger btn-sm" id="btnDeleteAll">
            <i class="fas fa-trash-alt me-1"></i>全部刪除
        </button>
    </div>
</div>

<!-- 通知來源說明 -->
<div class="alert alert-info border-0 mb-4" style="background: rgba(45,95,79,0.1);">
    <div class="d-flex align-items-center">
        <i class="fas fa-info-circle me-2"></i>
        <span>您的通知來源包含：<strong>平台方</strong>（系統公告、審核結果、結算通知）與 <strong>會員</strong>（訂單、退款申請、詢問）</span>
    </div>
</div>

<!-- 通知篩選 -->
<div class="btn-group flex-wrap mb-4" role="group">
    <button type="button" class="btn btn-outline-secondary active" data-filter="all">
        全部 <span class="badge bg-secondary ms-1" th:text="${totalCount}">0</span>
    </button>
    <button type="button" class="btn btn-outline-info" data-filter="platform">
        <i class="fas fa-building me-1"></i>平台通知 <span class="badge bg-info ms-1" th:text="${platformCount}">0</span>
    </button>
    <button type="button" class="btn btn-outline-warning" data-filter="member">
        <i class="fas fa-user me-1"></i>會員動態 <span class="badge bg-warning ms-1" th:text="${memberCount}">0</span>
    </button>
</div>

<!-- 通知列表 - 使用合併排序後的 allNotifies -->
<div class="list-group" id="notificationList">
    <div th:each="notify : ${allNotifies}"
         class="list-group-item list-group-item-action bg-dark border-secondary mb-2 rounded notification-item"
         th:classappend="${notify.isRead == 0} ? 'unread' : ''"
         th:data-type="${notify.type == 'MEMBER'} ? 'member' : 'platform'"
         th:data-id="${notify.id}">

        <div class="d-flex w-100 justify-content-between align-items-start">
            <div class="d-flex">
                <!-- 圖示根據類型顯示 -->
                <div class="rounded-circle p-2 me-3"
                     th:classappend="${notify.type == 'MEMBER'} ? 'bg-warning bg-opacity-10' : 'bg-info bg-opacity-10'">
                    <i th:class="${notify.type == 'MEMBER'} ? 'fas fa-shopping-cart text-warning' : 'fas fa-bullhorn text-info'"></i>
                </div>

                <div>
                    <h6 class="mb-1" th:classappend="${notify.isRead == 0} ? 'text-white' : 'text-muted'">
                        <span th:text="${notify.title}">通知標題</span>
                        <span th:if="${notify.isRead == 0}" class="badge bg-danger ms-2">未讀</span>
                    </h6>
                    <p class="mb-1 text-muted" th:text="${notify.content}">通知內容</p>
                    <div class="d-flex align-items-center mt-2">
                        <span th:if="${notify.type == 'MEMBER'}" class="badge bg-warning text-dark me-2">
                            <i class="fas fa-user me-1"></i>會員
                        </span>
                        <span th:if="${notify.type == 'PLATFORM'}" class="badge bg-info me-2">
                            <i class="fas fa-building me-1"></i>平台
                        </span>
                        <small class="text-muted" th:text="${#temporals.format(notify.createdAt, 'yyyy/MM/dd HH:mm')}">時間</small>
                        <small class="text-muted ms-2">| 來自：<span th:text="${notify.sourceName}">來源</span></small>
                    </div>
                </div>
            </div>
            <button th:if="${notify.isRead == 0}"
                    class="btn btn-sm btn-link p-0 text-decoration-none btn-mark-read"
                    th:data-id="${notify.id}"
                    th:data-notify-type="${notify.notifyType}">標記已讀</button>
        </div>
    </div>

    <!-- 無資料時顯示 -->
    <div th:if="${#lists.isEmpty(allNotifies)}" class="text-center text-muted py-5">
        <i class="fas fa-inbox fa-3x mb-3"></i>
        <p class="mb-0">目前沒有通知</p>
    </div>
</div>

<!-- 載入更多 -->
<div th:if="${not #lists.isEmpty(allNotifies)}" class="text-center mt-4">
    <button class="btn btn-outline-secondary">
        <i class="fas fa-plus me-2"></i>載入更多通知
    </button>
</div>