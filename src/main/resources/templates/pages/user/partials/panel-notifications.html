<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">通知中心</h3>
    <div>
        <button id="btnReadAll" class="btn btn-outline-light btn-sm me-2">
            <i class="fas fa-check-double me-1"></i>全部已讀</button>
        <button id="btnDeleteAll" class="btn btn-outline-danger btn-sm">
            <i class="fas fa-trash-alt me-1"></i>全部刪除</button>
    </div>
</div>

<div class="card bg-dark border-secondary">
    <div class="card-header border-secondary">
        <ul class="nav nav-tabs card-header-tabs flex-nowrap overflow-auto" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#notif-all">
                    全部
                    <span class="badge bg-secondary ms-1" th:if="${totalCount != null and totalCount > 0}" th:text="${totalCount}">0</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#notif-system">
                    平台公告
                    <span class="badge bg-primary ms-1" th:if="${systemCount != null and systemCount > 0}" th:text="${systemCount}">0</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#notif-organizer">
                    主辦方通知
                    <span class="badge bg-warning text-dark ms-1" th:if="${organizerCount != null and organizerCount > 0}" th:text="${organizerCount}">0</span>
                </a>
            </li>
        </ul>
    </div>
    <div class="card-body p-0">
        <div class="tab-content">
            <div class="tab-pane fade show active" id="notif-all">
                <div class="list-group list-group-flush">
                    <!-- 使用已排序的 allNotifies -->
                    <a th:each="notify : ${allNotifies}" href="javascript:void(0)"
                       th:data-id="${notify.id}"
                       th:data-type="${notify.type}"
                       th:classappend="${notify.isRead == 0} ? ' unread' : ''"
                       class="list-group-item list-group-item-action bg-dark text-white border-secondary p-4 position-relative notification-item">

                        <!-- 未讀標記 - 根據類型顯示不同顏色 -->
                        <div th:if="${notify.isRead == 0}"
                             th:class="${notify.type == 'ORGANIZER'} ? 'position-absolute top-0 start-0 h-100 bg-warning' : 'position-absolute top-0 start-0 h-100 bg-primary'"
                             style="width: 4px;"></div>

                        <div class="d-flex w-100 justify-content-between mb-1">
                            <div class="d-flex align-items-center">
                                <!-- 主辦方通知 badge -->
                                <span th:if="${notify.type == 'ORGANIZER'}" class="badge bg-warning text-dark me-2">
                                    <i class="fas fa-store"></i> 主辦方
                                </span>
                                <!-- 系統通知 badge -->
                                <span th:if="${notify.type == 'SYSTEM'}" class="badge bg-primary me-2">
                                    <i class="fas fa-bullhorn"></i> 系統
                                </span>
                                <h6 class="mb-0 fw-bold" th:text="${notify.title}">標題</h6>
                                <span th:if="${notify.isRead == 0}" class="badge bg-danger ms-2">未讀</span>
                            </div>
                            <small th:class="${notify.type == 'ORGANIZER'} ? 'text-warning' : 'text-primary'"
                                   th:text="${#temporals.format(notify.createdAt, 'yyyy/MM/dd HH:mm')}">時間</small>
                        </div>

                        <p class="mb-1 text-muted" th:text="${notify.content}">通知內容</p>

                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <small class="text-muted">
                                <i th:class="${notify.type == 'ORGANIZER'} ? 'fas fa-user-tie me-1' : 'fas fa-building me-1'"></i>來自：
                                <span th:text="${notify.sourceName}">來源</span>
                            </small>
                            <button th:if="${notify.isRead == 0}"
                                    class="btn btn-sm btn-link p-0 text-decoration-none btn-mark-read"
                                    th:data-type="${notify.type}"
                                    th:data-id="${notify.id}">標記已讀</button>
                        </div>
                    </a>
                    <!-- 無資料時顯示 -->
                    <div th:if="${#lists.isEmpty(allNotifies)}" class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <p class="mb-0">目前沒有通知</p>
                    </div>
                </div>
            </div>

            <!-- Platform System Notifications -->
            <div class="tab-pane fade" id="notif-system">
                <div class="list-group list-group-flush">
                    <a th:each="notify : ${notifyListData}" href="javascript:void(0)"
                       th:data-id="${notify.systemNotifyId}"
                       data-type="SYSTEM"
                       th:classappend="${notify.isRead == 0} ? ' unread' : ''"
                       class="list-group-item list-group-item-action bg-dark text-white border-secondary p-4 position-relative notification-item">
                        <div th:if="${notify.isRead == 0}" class="position-absolute top-0 start-0 h-100 bg-primary" style="width: 4px;"></div>
                        <div class="d-flex w-100 justify-content-between mb-1">
                            <div class="d-flex align-items-center">
                                <span class="badge bg-primary me-2"><i class="fas fa-bullhorn"></i> 系統</span>
                                <h6 class="mb-0 fw-bold" th:text="${notify.title}">系統標題</h6>
                                <span th:if="${notify.isRead == 0}" class="badge bg-danger ms-2">未讀</span>
                            </div>
                            <small class="text-primary" th:text="${#temporals.format(notify.createdAt, 'yyyy/MM/dd HH:mm')}">時間</small>
                        </div>
                        <p class="mb-1 text-muted" th:text="${notify.content}">內容</p>
                        <div class="d-flex justify-content-end mt-2">
                            <button th:if="${notify.isRead == 0}"
                                    class="btn btn-sm btn-link p-0 text-decoration-none btn-mark-read"
                                    th:data-id="${notify.systemNotifyId}"
                                    data-type="SYSTEM">標記已讀</button>
                        </div>
                    </a>
                    <!-- 無資料時顯示 -->
                    <div th:if="${#lists.isEmpty(notifyListData)}" class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <p class="mb-0">目前沒有平台公告</p>
                    </div>
                </div>
            </div>

            <!-- Organizer Notifications -->
            <div class="tab-pane fade" id="notif-organizer">
                <div class="list-group list-group-flush">
                    <a th:each="notify : ${notifyList}" href="javascript:void(0)"
                       th:data-id="${notify.memberNotifyId}"
                       data-type="ORGANIZER"
                       th:classappend="${notify.isRead == 0} ? ' unread' : ''"
                       class="list-group-item list-group-item-action bg-dark text-white border-secondary p-4 position-relative notification-item">
                        <div th:if="${notify.isRead == 0}" class="position-absolute top-0 start-0 h-100 bg-warning" style="width: 4px;"></div>
                        <div class="d-flex w-100 justify-content-between mb-1">
                            <div class="d-flex align-items-center">
                                <span class="badge bg-warning text-dark me-2"><i class="fas fa-store"></i> 主辦方</span>
                                <h6 class="mb-0 fw-bold" th:text="${notify.title}">標題</h6>
                                <span th:if="${notify.isRead == 0}" class="badge bg-danger ms-2">未讀</span>
                            </div>
                            <small class="text-warning" th:text="${#temporals.format(notify.createdAt, 'yyyy/MM/dd HH:mm')}">時間</small>
                        </div>
                        <p class="mb-1 text-muted" th:text="${notify.content}">內容</p>
                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <small class="text-muted"><i class="fas fa-user-tie me-1"></i>來自：
                                <span th:text="${notify.organizerNotifyVO?.organizerVO?.name ?: 'Momento 官方'}">主辦名稱</span>
                            </small>
                            <button th:if="${notify.isRead == 0}"
                                    class="btn btn-sm btn-link p-0 text-decoration-none btn-mark-read"
                                    th:data-id="${notify.memberNotifyId}"
                                    data-type="ORGANIZER">標記已讀</button>
                        </div>
                    </a>
                    <!-- 無資料時顯示 -->
                    <div th:if="${#lists.isEmpty(notifyList)}" class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <p class="mb-0">目前沒有主辦方通知</p>
                    </div>
                </div>
            </div>

            <!-- Order Notifications -->
            <div class="tab-pane fade" id="notif-orders">
                <div class="list-group list-group-flush">
                    <!-- TODO: 待接入訂單通知資料 -->
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <p class="mb-0">目前沒有訂單通知</p>
                    </div>
                </div>
            </div>

            <!-- Token Reward Notifications -->
            <div class="tab-pane fade" id="notif-promo">
                <div class="list-group list-group-flush">
                    <!-- TODO: 待接入代幣回饋資料 -->
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <p class="mb-0">目前沒有代幣回饋通知</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-footer border-secondary text-center">
        <button class="btn btn-sm btn-link text-muted text-decoration-none">查看歷史通知</button>
    </div>
</div>