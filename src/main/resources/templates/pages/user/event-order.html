<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>訂單確認 - Momento</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom Theme -->
    <link href="../../css/momento-theme.css" rel="stylesheet">

    <style>
        .order-summary-card {
            position: sticky;
            top: 100px;
        }

        .ticket-item {
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
        }

        .ticket-item:last-child {
            border-bottom: none;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container-fluid px-lg-5">
            <a class="navbar-brand" href="../../index.html">Momento</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" href="event-list.html">找活動</a></li>
                    <li class="nav-item"><a class="nav-link" href="prod-list.html">找商品</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">文章</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">關於我們</a></li>
                </ul>
                <div class="d-flex align-items-center gap-3 ms-lg-3 mt-3 mt-lg-0">
                    <a href="#" class="position-relative text-white text-decoration-none">
                        <i class="fas fa-shopping-cart fa-lg"></i>
                    </a>
                    <a href="login.html" class="btn btn-primary btn-sm px-4">會員登入</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-5">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../../index.html" class="text-decoration-none text-muted">首頁</a>
                </li>
                <li class="breadcrumb-item"><a href="event-list.html" class="text-decoration-none text-muted">找活動</a>
                </li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none text-muted"
                        id="breadcrumbEvent">活動詳情</a></li>
                <li class="breadcrumb-item active text-white" aria-current="page">訂單確認</li>
            </ol>
        </nav>

        <div class="row">
            <!-- Left: Order Form -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header border-secondary bg-transparent">
                        <h5 class="mb-0"><i class="fas fa-user-edit me-2"></i>訂購人資料</h5>
                    </div>
                    <div class="card-body">
                        <form id="orderForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">姓名 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="buyerName" required
                                        placeholder="請輸入真實姓名">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">手機 <span class="text-danger">*</span></label>
                                    <input type="tel" class="form-control" name="buyerPhone" required
                                        placeholder="0912345678" pattern="[0-9]{10}">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Email <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" name="buyerEmail" required
                                        placeholder="example@email.com">
                                    <small class="text-muted">電子票券將發送至此信箱</small>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Payment Method -->
                <div class="card mb-4">
                    <div class="card-header border-secondary bg-transparent">
                        <h5 class="mb-0"><i class="fas fa-credit-card me-2"></i>付款方式</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-3 p-3 border border-secondary rounded">
                            <input class="form-check-input" type="radio" name="paymentMethod" value="ECPAY"
                                id="payECPay" checked>
                            <label class="form-check-label w-100" for="payECPay">
                                <div class="d-flex align-items-center">
                                    <i class="far fa-credit-card me-2 text-primary"></i>
                                    <div>
                                        <strong>綠界科技</strong>
                                        <p class="text-muted small mb-0">信用卡 / ATM / 超商代碼</p>
                                    </div>
                                </div>
                            </label>
                        </div>
                        <div class="form-check p-3 border border-secondary rounded">
                            <input class="form-check-input" type="radio" name="paymentMethod" value="LINEPAY"
                                id="payLINEPay">
                            <label class="form-check-label w-100" for="payLINEPay">
                                <div class="d-flex align-items-center">
                                    <i class="fab fa-line me-2 text-success"></i>
                                    <div>
                                        <strong>LINE Pay</strong>
                                        <p class="text-muted small mb-0">使用 LINE Pay 快速付款</p>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Terms -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                            <label class="form-check-label" for="agreeTerms">
                                我已閱讀並同意 <a href="#" class="text-primary">服務條款</a> 及
                                <a href="#" class="text-primary">退票政策</a>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Order Summary -->
            <div class="col-lg-4">
                <div class="card order-summary-card">
                    <div class="card-header border-secondary bg-transparent">
                        <h5 class="mb-0"><i class="fas fa-receipt me-2"></i>訂單摘要</h5>
                    </div>
                    <div class="card-body">
                        <!-- Selected Tickets -->
                        <div id="selectedTickets" class="mb-3">
                            <!-- 動態載入票種 -->
                        </div>

                        <hr class="border-secondary">

                        <!-- Price Summary -->
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">小計</span>
                            <strong id="subtotal">NT$ 0</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-muted">總計</span>
                            <strong class="text-success fs-4" id="totalAmount">NT$ 0</strong>
                        </div>

                        <!-- Submit Button -->
                        <button type="button" class="btn btn-primary w-100 btn-lg mb-2" id="btnSubmitOrder">
                            <i class="fas fa-check-circle me-2"></i>確認訂單
                        </button>
                        <button type="button" class="btn btn-outline-secondary w-100" onclick="history.back()">
                            <i class="fas fa-arrow-left me-2"></i>返回修改
                        </button>

                        <p class="text-center text-muted small mt-3 mb-0">
                            <i class="fas fa-shield-alt me-1"></i>
                            您的付款資訊將受到保護
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="border-top border-secondary mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Momento</h5>
                    <p class="text-muted small">打造最棒的活動體驗平台</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="text-muted small mb-0">&copy; 2024 Momento. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Order Page Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 從 sessionStorage 載入選擇的票種
            const selections = JSON.parse(sessionStorage.getItem('ticketSelections') || '[]');

            if (selections.length === 0) {
                alert('未選擇票種，將返回活動頁面');
                history.back();
                return;
            }

            // 顯示選擇的票種
            let ticketsHtml = '';
            let total = 0;

            selections.forEach(item => {
                const subtotal = parseInt(item.price) * parseInt(item.quantity);
                total += subtotal;

                ticketsHtml += `
                    <div class="ticket-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <strong>${item.ticketName}</strong>
                                <p class="text-muted small mb-0">NT$ ${parseInt(item.price).toLocaleString()} × ${item.quantity}</p>
                            </div>
                            <strong class="text-success">NT$ ${subtotal.toLocaleString()}</strong>
                        </div>
                    </div>
                `;
            });

            document.getElementById('selectedTickets').innerHTML = ticketsHtml;
            document.getElementById('subtotal').textContent = 'NT$ ' + total.toLocaleString();
            document.getElementById('totalAmount').textContent = 'NT$ ' + total.toLocaleString();

            // 提交訂單
            document.getElementById('btnSubmitOrder').addEventListener('click', function () {
                const form = document.getElementById('orderForm');
                const agreeTerms = document.getElementById('agreeTerms');

                // 驗證表單
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                if (!agreeTerms.checked) {
                    alert('請先同意服務條款');
                    return;
                }

                // 收集訂單資料
                const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;

                const orderData = {
                    tickets: selections,
                    buyerName: form.buyerName.value,
                    buyerPhone: form.buyerPhone.value,
                    buyerEmail: form.buyerEmail.value,
                    paymentMethod: paymentMethod,
                    totalAmount: total
                };

                // 顯示訂單資料（實際應該提交到後端）
                console.log('訂單資料：', orderData);

                alert('訂單資料已準備完成！\n\n' +
                    '訂購人：' + orderData.buyerName + '\n' +
                    'Email：' + orderData.buyerEmail + '\n' +
                    '付款方式：' + (paymentMethod === 'ECPAY' ? '綠界科技' : 'LINE Pay') + '\n' +
                    '總金額：NT$ ' + total.toLocaleString() + '\n\n' +
                    '⚠️ 訂單處理、付款流程由其他模組負責');

                // 實際應該呼叫後端 API
                // fetch('/api/orders/create', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify(orderData)
                // })
                // .then(response => response.json())
                // .then(data => {
                //     // 導向付款頁面或成功頁面
                //     window.location.href = '/order/success?id=' + data.orderId;
                // });
            });
        });
    </script>
</body>

</html>